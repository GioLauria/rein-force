#!/usr/bin/env bash
# Pre-commit hook: compile and run quick tests to catch obvious errors
set -e
ROOT_DIR="$(git rev-parse --show-toplevel)"
cd "$ROOT_DIR"

# Prefer Maven Wrapper
if [ -x ./mvnw ]; then
  MVN=./mvnw
elif [ -x ./mvnw.cmd ]; then
  MVN=./mvnw.cmd
else
  MVN=mvn
fi

echo "[pre-commit] Running full package build with $MVN (this may run tests)"
# Run full package to ensure commits always produce a working package
"$MVN" package

RC=$?
if [ $RC -ne 0 ]; then
  echo "[pre-commit] Build failed (exit $RC) â€” aborting commit"
  exit $RC
fi

echo "[pre-commit] Build OK"
exit 0
